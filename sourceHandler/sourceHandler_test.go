package sourceHandler

import (
	"github.com/stretchr/testify/assert"
	"testing"
)

func Test_New_SourceData(t *testing.T) {
	testStringShort := "Here comes the candle to light you to bed.  Here comes the chopper to chop off your head."
	testStringLong := "Trump opens 2024 run, says he's 'more committed' than ever\n\nMEG KINNARD, HOLLY RAMER and JILL COLVIN\nSat, January 28, 2023 at 12:23 AM EST\n\nCOLUMBIA, S.C. (AP) — Former President Donald Trump kicked off his 2024 White House bid with stops Saturday in New Hampshire and South Carolina, events in early-voting states marking the first campaign appearances since announcing his latest run more than two months ago.\n\n“Together we will complete the unfinished business of making America great again,\" Trump said at an evening event in Columbia to introduce his South Carolina leadership team.\n\nTrump and his allies hope the events in states with enormous power in selecting the nominee will offer a show of force behind the former president after a sluggish start to his campaign that left many questioning his commitment to running again.\n\n“They said, ‘He’s not doing rallies, he’s not campaigning. Maybe he’s lost that step,’\" Trump said at the New Hampshire GOP’s annual meeting in Salem, his first event.\n\n- ADVERTISEMENT -\n\nBut, he told the audience of party leaders, “I’m more angry now and I’m more committed now than I ever was.” In South Carolina, he further dismissed the speculation by saying that ”we have huge rallies planned, bigger than ever before.\"\n\nWhile Trump has spent the months since he announced largely ensconced in his Florida club and at his nearby golf course, his aides insist they have been busy behind the scenes. His campaign opened a headquarters in Palm Beach, Florida, and has been hiring staff. And in recent weeks, backers have been reaching out to political operatives and elected officials to secure support for Trump at a critical point when other Republicans are preparing their own expected challenges.\n\nIn New Hampshire, Trump promoted his campaign agenda, including immigration and crime, and said his policies would be the opposite of President Joe Biden's. He cited the Democrats' move to change the election calendar, costing New Hampshire its leadoff primary spot, and accused Biden, a fifth-place finisher in New Hampshire in 2020, of \"disgracefully trashing this beloved political tradition.”\n\n“I hope you’re going to remember that during the general election,” Trump told party members. Trump himself twice won the primary, but lost the state each time to Democrats.\n\nLater in South Carolina, Trump said he planned to keep the state's presidential primary as the “first in the South” and called it “a very important state.\"\n\nIn his speech, he hurtled from criticism of Biden and Democrats to disparaging comments about transgender people, mockery of people promoting the use of electric stoves and electric cars, and reminiscing about efforts while serving as president to increase oil production, strike trade deals and crack down on migration at the U.S-Mexico border.\n\nWhile Trump remains the only declared 2024 presidential candidate, potential challengers, including Florida Gov. Ron DeSantis, former Vice President Mike Pence and former South Carolina Gov. Nikki Haley, who was Trump's ambassador to the United Nations, are expected to get their campaigns underway in the coming months.\n\nAfter his South Carolina speech, Trump told The Associated Press in an interview that it would be “a great act of disloyalty” if DeSantis opposed him in the primary and took credit for the governor's initial election.\n\n“If he runs, that’s fine. I’m way up in the polls,” Trump said. “He’s going to have to do what he wants to do, but he may run. I do think it would be a great act of disloyalty because, you know, I got him in. He had no chance. His political life was over.”\n\nHe said he hasn’t spoken to DeSantis in a long time.\n\nGov. Henry McMaster, U.S. Sen. Lindsey Graham and several members of the state's congressional delegation attended Trump's event at the Statehouse.\n\nTrump's team has struggled to line up support from South Carolina lawmakers, even some who eagerly backed him before. Some have said that more than a year out from primary balloting is too early to make endorsements or that they are waiting to see who else enters the race. Others have said it is time for the party to move past Trump to a new generation of leadership.\n\nSouth Carolina House Speaker Murrell Smith was among the legislative leaders awaiting Trump's arrival, although he said he was there not to make a formal endorsement but to welcome the former president to the state in his role as speaker.\n\nOtherwise, dozens of supporters crammed into the ceremonial lobby between the state House and Senate, competing with reporters and camera crews for space among marble-topped tables and a life-sized bronze statue of former Vice President John C. Calhoun.\n\nDave Wilson, president of conservative Christian nonprofit Palmetto Family, said some conservative voters may have concerns about Trump's recent comments that Republicans who opposed abortion without exceptions had cost the party in the November elections. This is the end\n"
	sdShort := New_SourceData([]byte(testStringShort))
	sdLong := New_SourceData([]byte(testStringLong))
	assert.NotNil(t, sdShort.Base13Hash)
	assert.NotNil(t, sdShort.Base53Hash)
	assert.NotNil(t, sdLong.Base13Hash)
	assert.NotNil(t, sdLong.Base53Hash)
	assert.Equal(t, 22, sdShort.ChunkSize)
	assert.Equal(t, 1, sdShort.LastChunkSize)
	assert.Equal(t, 256, sdLong.ChunkSize)
	assert.Equal(t, 156, sdLong.LastChunkSize)
	assert.Equal(t, uint32(len(testStringShort)), sdShort.Size)
	assert.Equal(t, uint32(len(testStringLong)), sdLong.Size)
}
func TestSourceData_ToPacket(t *testing.T) {
	testStringLong := "Trump opens 2024 run, says he's 'more committed' than ever\n\nMEG KINNARD, HOLLY RAMER and JILL COLVIN\nSat, January 28, 2023 at 12:23 AM EST\n\nCOLUMBIA, S.C. (AP) — Former President Donald Trump kicked off his 2024 White House bid with stops Saturday in New Hampshire and South Carolina, events in early-voting states marking the first campaign appearances since announcing his latest run more than two months ago.\n\n“Together we will complete the unfinished business of making America great again,\" Trump said at an evening event in Columbia to introduce his South Carolina leadership team.\n\nTrump and his allies hope the events in states with enormous power in selecting the nominee will offer a show of force behind the former president after a sluggish start to his campaign that left many questioning his commitment to running again.\n\n“They said, ‘He’s not doing rallies, he’s not campaigning. Maybe he’s lost that step,’\" Trump said at the New Hampshire GOP’s annual meeting in Salem, his first event.\n\n- ADVERTISEMENT -\n\nBut, he told the audience of party leaders, “I’m more angry now and I’m more committed now than I ever was.” In South Carolina, he further dismissed the speculation by saying that ”we have huge rallies planned, bigger than ever before.\"\n\nWhile Trump has spent the months since he announced largely ensconced in his Florida club and at his nearby golf course, his aides insist they have been busy behind the scenes. His campaign opened a headquarters in Palm Beach, Florida, and has been hiring staff. And in recent weeks, backers have been reaching out to political operatives and elected officials to secure support for Trump at a critical point when other Republicans are preparing their own expected challenges.\n\nIn New Hampshire, Trump promoted his campaign agenda, including immigration and crime, and said his policies would be the opposite of President Joe Biden's. He cited the Democrats' move to change the election calendar, costing New Hampshire its leadoff primary spot, and accused Biden, a fifth-place finisher in New Hampshire in 2020, of \"disgracefully trashing this beloved political tradition.”\n\n“I hope you’re going to remember that during the general election,” Trump told party members. Trump himself twice won the primary, but lost the state each time to Democrats.\n\nLater in South Carolina, Trump said he planned to keep the state's presidential primary as the “first in the South” and called it “a very important state.\"\n\nIn his speech, he hurtled from criticism of Biden and Democrats to disparaging comments about transgender people, mockery of people promoting the use of electric stoves and electric cars, and reminiscing about efforts while serving as president to increase oil production, strike trade deals and crack down on migration at the U.S-Mexico border.\n\nWhile Trump remains the only declared 2024 presidential candidate, potential challengers, including Florida Gov. Ron DeSantis, former Vice President Mike Pence and former South Carolina Gov. Nikki Haley, who was Trump's ambassador to the United Nations, are expected to get their campaigns underway in the coming months.\n\nAfter his South Carolina speech, Trump told The Associated Press in an interview that it would be “a great act of disloyalty” if DeSantis opposed him in the primary and took credit for the governor's initial election.\n\n“If he runs, that’s fine. I’m way up in the polls,” Trump said. “He’s going to have to do what he wants to do, but he may run. I do think it would be a great act of disloyalty because, you know, I got him in. He had no chance. His political life was over.”\n\nHe said he hasn’t spoken to DeSantis in a long time.\n\nGov. Henry McMaster, U.S. Sen. Lindsey Graham and several members of the state's congressional delegation attended Trump's event at the Statehouse.\n\nTrump's team has struggled to line up support from South Carolina lawmakers, even some who eagerly backed him before. Some have said that more than a year out from primary balloting is too early to make endorsements or that they are waiting to see who else enters the race. Others have said it is time for the party to move past Trump to a new generation of leadership.\n\nSouth Carolina House Speaker Murrell Smith was among the legislative leaders awaiting Trump's arrival, although he said he was there not to make a formal endorsement but to welcome the former president to the state in his role as speaker.\n\nOtherwise, dozens of supporters crammed into the ceremonial lobby between the state House and Senate, competing with reporters and camera crews for space among marble-topped tables and a life-sized bronze statue of former Vice President John C. Calhoun.\n\nDave Wilson, president of conservative Christian nonprofit Palmetto Family, said some conservative voters may have concerns about Trump's recent comments that Republicans who opposed abortion without exceptions had cost the party in the November elections. This is the end\n"
	sd := New_SourceData([]byte(testStringLong))
	sp := sd.ToPacket()
	assert.Equal(t, sp.Base13Hash, sd.Base13Hash)
	assert.Equal(t, sp.Base53Hash, sd.Base53Hash)
	assert.Equal(t, sp.Size, sd.Size)
	assert.Equal(t, sp.ChunkSize, sd.ChunkSize)
	assert.Equal(t, sp.LastChunkSize, sd.LastChunkSize)
}

func TestSourceData_NewChunks(t *testing.T) {
	testStringLong := "Trump opens 2024 run, says he's 'more committed' than ever\n\nMEG KINNARD, HOLLY RAMER and JILL COLVIN\nSat, January 28, 2023 at 12:23 AM EST\n\nCOLUMBIA, S.C. (AP) — Former President Donald Trump kicked off his 2024 White House bid with stops Saturday in New Hampshire and South Carolina, events in early-voting states marking the first campaign appearances since announcing his latest run more than two months ago.\n\n“Together we will complete the unfinished business of making America great again,\" Trump said at an evening event in Columbia to introduce his South Carolina leadership team.\n\nTrump and his allies hope the events in states with enormous power in selecting the nominee will offer a show of force behind the former president after a sluggish start to his campaign that left many questioning his commitment to running again.\n\n“They said, ‘He’s not doing rallies, he’s not campaigning. Maybe he’s lost that step,’\" Trump said at the New Hampshire GOP’s annual meeting in Salem, his first event.\n\n- ADVERTISEMENT -\n\nBut, he told the audience of party leaders, “I’m more angry now and I’m more committed now than I ever was.” In South Carolina, he further dismissed the speculation by saying that ”we have huge rallies planned, bigger than ever before.\"\n\nWhile Trump has spent the months since he announced largely ensconced in his Florida club and at his nearby golf course, his aides insist they have been busy behind the scenes. His campaign opened a headquarters in Palm Beach, Florida, and has been hiring staff. And in recent weeks, backers have been reaching out to political operatives and elected officials to secure support for Trump at a critical point when other Republicans are preparing their own expected challenges.\n\nIn New Hampshire, Trump promoted his campaign agenda, including immigration and crime, and said his policies would be the opposite of President Joe Biden's. He cited the Democrats' move to change the election calendar, costing New Hampshire its leadoff primary spot, and accused Biden, a fifth-place finisher in New Hampshire in 2020, of \"disgracefully trashing this beloved political tradition.”\n\n“I hope you’re going to remember that during the general election,” Trump told party members. Trump himself twice won the primary, but lost the state each time to Democrats.\n\nLater in South Carolina, Trump said he planned to keep the state's presidential primary as the “first in the South” and called it “a very important state.\"\n\nIn his speech, he hurtled from criticism of Biden and Democrats to disparaging comments about transgender people, mockery of people promoting the use of electric stoves and electric cars, and reminiscing about efforts while serving as president to increase oil production, strike trade deals and crack down on migration at the U.S-Mexico border.\n\nWhile Trump remains the only declared 2024 presidential candidate, potential challengers, including Florida Gov. Ron DeSantis, former Vice President Mike Pence and former South Carolina Gov. Nikki Haley, who was Trump's ambassador to the United Nations, are expected to get their campaigns underway in the coming months.\n\nAfter his South Carolina speech, Trump told The Associated Press in an interview that it would be “a great act of disloyalty” if DeSantis opposed him in the primary and took credit for the governor's initial election.\n\n“If he runs, that’s fine. I’m way up in the polls,” Trump said. “He’s going to have to do what he wants to do, but he may run. I do think it would be a great act of disloyalty because, you know, I got him in. He had no chance. His political life was over.”\n\nHe said he hasn’t spoken to DeSantis in a long time.\n\nGov. Henry McMaster, U.S. Sen. Lindsey Graham and several members of the state's congressional delegation attended Trump's event at the Statehouse.\n\nTrump's team has struggled to line up support from South Carolina lawmakers, even some who eagerly backed him before. Some have said that more than a year out from primary balloting is too early to make endorsements or that they are waiting to see who else enters the race. Others have said it is time for the party to move past Trump to a new generation of leadership.\n\nSouth Carolina House Speaker Murrell Smith was among the legislative leaders awaiting Trump's arrival, although he said he was there not to make a formal endorsement but to welcome the former president to the state in his role as speaker.\n\nOtherwise, dozens of supporters crammed into the ceremonial lobby between the state House and Senate, competing with reporters and camera crews for space among marble-topped tables and a life-sized bronze statue of former Vice President John C. Calhoun.\n\nDave Wilson, president of conservative Christian nonprofit Palmetto Family, said some conservative voters may have concerns about Trump's recent comments that Republicans who opposed abortion without exceptions had cost the party in the November elections. This is the end\n"
	testBytes := []byte(testStringLong)
	sd := New_SourceData([]byte(testStringLong))
	mapNoChunks := make(map[uint32][]byte)
	mapLastChunk := make(map[uint32][]byte)
	mapMiddleChunk := make(map[uint32][]byte)
	mapMiddleAndLast := make(map[uint32][]byte)
	mapLastChunk[4864] = []byte{}
	mapMiddleChunk[256] = []byte{}
	mapMiddleAndLast[256] = []byte{}
	mapMiddleAndLast[4864] = []byte{}
	assert.Equal(t, make(map[uint32][]byte), sd.NewChunks(mapNoChunks))
	assert.Equal(t, map[uint32][]byte{256: testBytes[256:512]}, sd.NewChunks(mapMiddleChunk))
	assert.Equal(t, map[uint32][]byte{4864: testBytes[4864:]}, sd.NewChunks(mapLastChunk))
	assert.Equal(t, map[uint32][]byte{256: testBytes[256:512], 4864: testBytes[4864:]}, sd.NewChunks(mapMiddleAndLast))
}
